{% extends 'base.html' %}
{% block title %}
My Todo's

  
{% endblock title %}



{% block body %}
    <nav class="navbar navbar-expand-lg navcolor">
        <div class="container-fluid">
          <a class="navbar-brand text-light" href="{{url_for('home')}}">To-Do List</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarText">

            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-light" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      {{uemail}}
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" style="font-size:0.8rem;" href="{{url_for('logout')}}" onclick="logoutlocal()">Logout</a></li>
                        <li><a class="dropdown-item" style="font-size:0.8rem;" href="{{url_for('forget_password')}}">Change <br> Password</a></li>
                    </ul>
                  </li>

            </ul>
          </div>
        </div>
    </nav>
    <style>
        .navcolor{


  background: #7474BF;  /* fallback for old browsers */
  background: -webkit-linear-gradient(to right, #348AC7, #7474BF);  /* Chrome 10-25, Safari 5.1-6 */
  background: linear-gradient(to right, #348AC7, #7474BF); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */




  }

  </style>
<br>
<div class="container">

  <div class="row">
    <div class="col-md-3"></div>
    <div class="col-md-3"></div>
    <div class="col-md-3"></div>
    <div class="col-md-3">
      <button type="button" class="btn btn-sm btn-success text-right" style="width: 10rem;" id="createtask"  data-bs-toggle="modal" data-bs-target="#exampleModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
        </svg>  Add a New Task
      </button>
      <div class="example-element" ></div>

    </div>
  </div>
  <div class="row">

  </div>
  <div class="row mt-5">

    <div class="col-md-3">
      <a href="/pending">
      <div class="col-md-3">
        <div class="card bg-danger" style="width: 15rem;">
          <div class="card-body text-light">
            <h5 class="card-title">Pending</h5>

            <p class="card-text text-light">{{pen}}</p>

          </div>
        </div>
      </a>
    </div>
      <div class="pending-element" ></div>

    </div>
    <div class="col-md-3">
      <a href="/progress">
        <div class="card bg-info" style="width: 15rem;">
          <div class="card-body">
            <h5 class="card-title text-light">On progress</h5>

            <p class="card-text text-light">{{prog}}</p>

          </div>
        </div>
      </a>

    </div>
    <div class="col-md-3">
      <a href="/complete">
        <div class="card bg-success" style="width: 15rem;">
          <div class="card-body">
            <h5 class="card-title text-light">Completed</h5>

            <p class="card-text text-light">{{com}}</p>

          </div>
        </div>
      </a>

    </div>
    <div class="col-md-3">
      <a href="/nonpriority">
        <div class="card bg-warning" style="width: 15rem; color: #0000FF ">
          <div class="card-body">
            <h5 class="card-title">Non-Prioritized</h5>

            <p class="card-text">{{nop}}</p>

          </div>
        </div>
      </a>
    </div>
    <style>
      a {
        text-decoration: none;
      }
      .borderless-button {
            background-color: transparent;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            text-align: left;
      }
      .card {
        border-radius: 4px;
        background: #fff;
        box-shadow: 0 6px 10px rgba(0, 0, 0, .08), 0 0 6px rgba(0, 0, 0, .05);
        transition: .3s transform cubic-bezier(.155, 1.105, .295, 1.12), .3s box-shadow, .3s -webkit-transform cubic-bezier(.155, 1.105, .295, 1.12);
        /* padding: 14px 80px 18px 36px; */
        cursor: pointer;
      }

      .card:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0, 0, 0, .12), 0 4px 8px rgba(0, 0, 0, .06);
      }
    </style>
  </div>
  <div class="row">
    <br>
  </div>
  <div class="row">

    <h2>Your ToDo's</h2>
  </div>
  <br>
  <div class="row">

    
    <div class="col-md-3">

    <button type="button" class="btn btn-outline-info btn-sm" id="updateelement" data-bs-toggle="modal" data-bs-target="#exampleModal1">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2-square" viewBox="0 0 16 16">
  <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5H3z"/>
  <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z"/>
</svg> Update/Delete a Task
    </button>
      <br>
    <div class="update-element" ></div>
    </div>
    <div class="col-md-5"></div>
    <div class="col-md-4">
    </div>
  </div>

    {% if allTodo|length==0 %}
      <br>
      <div class="alert alert-warning" role="alert">
        No Records Found. Add some now !!!!!
      </div>
    {% else %}
      <div class="row mt-3">
        <div id="myGrid" style="height: 25rem;" class="ag-theme-alpine"></div>
      </div>
    {% endif %}

</div>

<script>
  var columnDefs = [
    {headerName: "Serial No", field: "sno",hide:true},
    {headerName: "Title", field: "title",checkboxSelection: true},
    {headerName: "Description", field: "description"},
    {headerName: "Label", field: "differ"},
    {headerName: "Status", field: "status"},
    {headerName: "Created Time", field: "date_created"},
    {headerName: "Deadline", field: "date_deadline"},
  ];

  // specify the data
  var rowData = {{allTodo|tojson}}
  console.log(rowData)

  // let the grid know which columns and what data to use
  var gridOptions = {
    defaultColDef: {
        resizable: true,
    },
    suppressDragLeaveHidesColumns: true,
    columnDefs: columnDefs,
    onFirstDataRendered: onFirstDataRendered,

    rowData: rowData
  };
  function onFirstDataRendered(params) {
    params.api.sizeColumnsToFit();
  }


  // setup the grid after the page has finished loading
  document.addEventListener('DOMContentLoaded', function() {
      var gridDiv = document.querySelector('#myGrid');
      new agGrid.Grid(gridDiv, gridOptions);
  });



  // creating a task
  document.getElementById('createtask').addEventListener('click',function(){


        document.querySelector('.example-element').innerHTML = `
                    <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Task</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="/newtask" method="POST">
                                <div class="mb-3">
                                    <label for="title" class="form-label">To-Do Title</label>
                                    <input type="text" class="form-control" name="title" id="title" aria-describedby="emailHelp">
                                </div>
                                <div class="mb-3">
                                    <label for="desc" class="form-label">To-Do Description :</label>
                                    <input type="text-area" class="form-control" name="desc" id="desc">
                                </div>
                                <div class="row">
                                    <div class="col-md-2">
                                        <label for="Priority" class="form-label">To-Do Priority :</label>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-control form-select-md" name="Priority" id="Priority">
                                            <option value="Pending">Pending</option>
                                            <option selected value="On Progress">On Progress</option>
                                            <option value="Completed">Completed</option>
                                            <option value="Non-Prioritized">Non-Prioritized</option>
                                        </select>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-2">
                                        <label for="workdivision" class="form-label">To-Do For :</label>
                                    </div>
                                    <div class="col-md-4">
                                        <select class="form-control form-select-md" name="workdivision" id="workdivision">
                                            <option value="Home">Home</option>
                                            <option value="Work">Work</option>
                                            <option selected value="Personal">Personal</option>

                                        </select>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                    <div class="col-md-2">
                                        <label class="form-label form-label" for="finish">Finish Time :</label>
                                    </div>
                                    <div class="col-md-3">
                                        <input id="finish" type="date" name="finish" style="text-align: center;">
                                    </div>

                                </div>
                                <br>
                                <button type="submit" class="btn btn-outline-primary">Submit <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16">
                                  <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                                </svg></button>
                            </form>
                        </div>

                    </div>
                </div>
            </div>`;
  })


  //update and delete
   document.getElementById('updateelement').addEventListener('click',function(){
    var selectedRow = gridOptions.api.getSelectedRows();
        if(selectedRow[0]){
        if(selectedRow[0]['date_deadline']!=null){
        var inputDateString = selectedRow[0]['date_deadline'];

        // Parse the input date string into a Date object
        var inputDate = new Date(inputDateString);

        // Extract the components of the date and time
        var year = inputDate.getFullYear();
        var month = (inputDate.getMonth() + 1).toString().padStart(2, '0'); // Months are 0-based, so add 1 and pad with '0' if needed
        var day = inputDate.getDate().toString().padStart(2, '0');


        // Create the desired format
        var outputDateString = year + '-' + month + '-' + day ;
        }else{
          var outputDateString = null;
        }
        document.querySelector('.update-element').innerHTML = `
        <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel1" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel1">Update or Delete Task</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">

                              <form action="/update/${selectedRow[0]['sno']}" method="POST">
                              <div class="mb-3">
                                <label for="title" class="form-label">To-Do Title</label>
                                <input type="text" class="form-control" name="title" id="title" value="${selectedRow[0]['title']}" aria-describedby="emailHelp">
                              </div>
                              <div class="mb-3">
                                <label for="desc" class="form-label">To-Do Description</label>
                                <input type="text" class="form-control" name="desc" id="desc" value="${selectedRow[0]['description']}">
                              </div>
                              <br>
                              <div class="row">
                                <div class="col-md-2">
                                  <label for="Priority" class="form-label">To-Do Priority :</label>
                                </div>
                                <div class="col-md-4">
                                  <select class="form-select form-select-md" name="Priority" id="Priority" aria-label="Default select example" >
                                    <option selected >${selectedRow[0]['status']}</option>
                                    <option value="Pending">Pending</option>
                                    <option value="On Progress">On Progress</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Non-Prioritized">Non-Prioritized</option>
                                  </select>
                                </div>
                              </div>
                              <br>
                              <div class="row">
                                <div class="col-md-2">
                                  <label for="workdivision" class="form-label">To-Do For :</label>
                                </div>
                                <div class="col-md-4">
                                  <select class="form-select form-select-md" name="workdivision" id="workdivision" aria-label="Default select example" >
                                      <option selected >${selectedRow[0]['differ']}</option>
                                      <option value="Home">Home</option>
                                      <option value="Work">Work</option>
                                      <option value="Personal">Personal</option>
                                  </select>
                                </div>
                              </div>
                              <br>
                              <div class="row">
                                <div class="col-md-2">
                                  <label class="form-label form-label" for="finish">Finish Time  :</label>
                                </div>
                                <div class="col-md-3">


                                  <input id="finish" type="date" name="finish"  style="text-align: center;" value="${outputDateString}">

                                  <input type="number" name="sno" value="${selectedRow[0]['sno']}" hidden>
                                </div>

                              </div>
                              <br>
                              <div class="modal-footer">

                                <button type="submit" class="btn btn-outline-success"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-floppy" viewBox="0 0 16 16">
                                  <path d="M11 2H9v3h2V2Z"/>
                                  <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0ZM1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5Zm3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4v4.5ZM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5V15Z"/>
                                </svg> Save</button>


                                 <a class="btn btn-outline-danger" href="/delete/${selectedRow[0]['sno']}" role="button"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                                  </svg> Delete</a>


                              </div>

                            </form>
                                              </div>

                                          </div>
                                      </div>
                                  </div>
        `;
        }
        else{
            // alert
            document.querySelector('.update-element').innerHTML = `
            <div class="alert alert-warning" role="alert">
              Select a Row !!!!!
            </div>

           `;
        }
   });





</script>
  

{% endblock body %}